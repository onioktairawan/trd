<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Jurnal Trading</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.13.5/css/dataTables.bootstrap5.min.css" rel="stylesheet">
  <style>
    body.dark { background-color: #121212 !important; color: #f0f0f0; }
    .dark .table, .dark .form-control, .dark .btn { background-color: #333 !important; color: #fff; border-color: #555; }
    .dark .card { background-color: #1e1e1e; border-color: #444; }
    .dark .card-title, .dark .card-text { color: #f0f0f0 !important; }
    .dark .dataTables_wrapper,
    .dark .dataTables_filter input,
    .dark .dataTables_length select,
    .dark .paginate_button,
    .dark .table-striped > tbody > tr:nth-of-type(odd) {
      background-color: #1e1e1e !important;
      color: #f0f0f0 !important;
      border-color: #444 !important;
    }
    .dark .paginate_button.current {
      background-color: #444 !important;
      color: #fff !important;
    }
    .result-tp { color: limegreen; font-weight: bold; }
    .result-sl { color: red; font-weight: bold; }
    .theme-toggle { position: fixed; top: 1rem; right: 1rem; cursor: pointer; }
    @media (max-width: 768px) {
      .table-responsive { overflow-x: auto; }
    }
  </style>
</head>
<body class="bg-light p-4" id="body">
  <div class="theme-toggle">
    <button class="btn btn-outline-secondary" onclick="toggleTheme()">üåô/‚òÄÔ∏è</button>
  </div>
  <div class="container">
    <div class="d-flex justify-content-end">
      <a href="/logout" class="btn btn-outline-danger mb-3">Logout ({{ session['username'] }})</a>
    </div>
    <h2 class="text-center mb-4">Jurnal Trading XAUUSD</h2>

    <form method="POST" class="mb-5" onsubmit="return confirm('Yakin data sudah benar?')">
      <div class="row g-3">
        <div class="col-md-4">
          <label>Lot Size</label>
          <input type="number" step="0.01" min="0.01" name="lot" class="form-control" required>
        </div>
        <div class="col-md-4">
          <label>Open Price</label>
          <input type="number" step="0.001" name="open_price" class="form-control" required>
        </div>
        <div class="col-md-4">
          <label>Stop Loss</label>
          <input type="number" step="0.001" name="sl" class="form-control" required>
        </div>
        <div class="col-md-4">
          <label>Take Profit</label>
          <input type="number" step="0.001" name="tp" class="form-control" required>
        </div>
        <div class="col-md-4">
          <label>Hasil</label>
          <select name="result" class="form-control" required>
            <option value="TP">‚úîÔ∏è TP</option>
            <option value="SL">‚ùå SL</option>
          </select>
        </div>
        <div class="col-md-4">
          <label>Keterangan</label>
          <select name="note" class="form-control">
            <option value="Buy">Buy</option>
            <option value="Sell">Sell</option>
          </select>
        </div>
      </div>
      <button type="submit" class="btn btn-primary mt-4">Simpan</button>
      <a href="/set-equity" class="btn btn-warning mt-4 ms-2">Atur Equity Awal</a>
      <a href="/export" class="btn btn-success mt-4 ms-2">Export CSV</a>
    </form>

    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card text-center">
          <div class="card-body">
            <h5 class="card-title">Total Trades</h5>
            <p class="card-text fs-4">{{ stats.total }}</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center">
          <div class="card-body">
            <h5 class="card-title">Total TP</h5>
            <p class="card-text fs-4 text-success">{{ stats.tp }}</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center">
          <div class="card-body">
            <h5 class="card-title">Total SL</h5>
            <p class="card-text fs-4 text-danger">{{ stats.sl }}</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center">
          <div class="card-body">
            <h5 class="card-title">Winrate</h5>
            <p class="card-text fs-4">{{ stats.winrate }}%</p>
          </div>
        </div>
      </div>
    </div>

    <div class="table-responsive">
      <table id="tradeTable" class="table table-bordered table-striped shadow-sm">
        <thead>
          <tr>
            <th>No</th>
            <th>Tanggal & Waktu</th>
            <th>Lot</th>
            <th>Open Price</th>
            <th>SL</th>
            <th>TP</th>
            <th>Hasil</th>
            <th>Keterangan</th>
            <th>Profit</th>
            <th>Equity After</th>
          </tr>
        </thead>
        <tbody>
          {% for trade in trades %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ trade.date }}</td>
            <td>{{ trade.lot }}</td>
            <td>{{ trade.open_price }}</td>
            <td>{{ trade.sl }}</td>
            <td>{{ trade.tp }}</td>
            <td class="{{ 'result-tp' if trade.result == 'TP' else 'result-sl' }}">{{ trade.result }}</td>
            <td>{{ trade.note }}</td>
           <td>${{ '%.2f'|format(trade.profit | default(0)) }}</td>
           <td>${{ '%.2f'|format(trade.equity_after | default(0)) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.5/js/dataTables.bootstrap5.min.js"></script>
  <script>
    $(document).ready(function() {
      $('#tradeTable').DataTable();
    });
    function toggleTheme() {
      const body = document.getElementById('body');
      const dark = body.classList.toggle('dark');
      localStorage.setItem('theme', dark ? 'dark' : 'light');
      document.querySelectorAll('.dataTables_wrapper').forEach(e => {
        if (dark) e.classList.add('dark');
        else e.classList.remove('dark');
      });
    }
    window.onload = () => {
      if (localStorage.getItem('theme') === 'dark') {
        document.getElementById('body').classList.add('dark');
        setTimeout(() => {
          document.querySelectorAll('.dataTables_wrapper').forEach(e => e.classList.add('dark'));
        }, 100);
      }
    }
  </script>
</body>
</html>

